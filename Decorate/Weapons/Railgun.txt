Actor RailgunToken : Inventory {}
Actor RailgunZoomed : Inventory {}

Actor GMIDRailgun : PlasmaRifle
{
	Weapon.AmmoUse 10
    Weapon.AmmoGive 40
	Weapon.BobRangeX 0.3
	Weapon.BobRangeY 0.5
	Weapon.BobStyle InverseSmooth
	Weapon.BobSpeed 2.0
	Weapon.UpSound "railup"
	Tag "$TAG_RAIL"
	Weapon.AmmoType1 "NewCell"
	Weapon.AmmoUse 10
	+WEAPON.NOALERT
	Inventory.PickupMessage "$GOTRAIL"
	Obituary "$OB_RAIL"
	Inventory.Icon "RGNGA0B0"
	Weapon.SelectionOrder 200
	states
	{
		Fire:
			RGUN A 0 A_AlertMonsters
			RGUN A 0 A_JumpIfInventory("PowerQuadDamageST", 1, "QuadFire")
			RGUN A 0 A_JumpIfInventory("PowerDoubleDamage", 1, "DoubleFire")
			Goto ContinueFire
		QuadFire:
		    TNT1 A 0 A_SetBlend("Blue", 0.25, 16)
			RGUN A 0 A_PlaySound("QuadDamage/Use")
			Goto ContinueFire
		DoubleFire:
		    TNT1 A 0 A_SetBlend("Red", 0.25, 16)
			RGUN A 0 A_PlaySound("DoubleDamage/Use")
		ContinueFire:
			RGUN A 0 A_JumpIfInventory("RailgunZoomed",1,"ZoomedFire")
			RGUN A 0 A_SetPitch(pitch-1)
			RGUN B 0 Bright A_RailAttack(300, 0, 1, "DarkGreen", "Green",0,0,"GMIDRailgunPuff")
			RGUN B 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGUN C 0 A_SetPitch(pitch+0.50)
			RGUN C 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGUN D 0 A_SetPitch(pitch+0.50)
			RGUN DEFGH 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGUN I 10 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGUN I 0 A_JumpIfInventory("NewCell",10,"Recharge")
			RGUN I 0 A_PlaySound("railgun/empty",CHAN_AUTO)
			RGUN IHGFEDJK 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			goto Ready
		Recharge:
			RGUN I 0 A_PlaySound("railgun/charge",CHAN_AUTO)
			RGUN I 40 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGUN HGFEDJ 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGUN K 1 A_WeaponReady
			goto Ready
		ZoomedFire:
			RGSP B 0 A_SetPitch(pitch-1)
			RGSP B 0 A_ZoomFactor(2.8)
			RGSP C 0 Bright A_RailAttack(300, 0, 1, "DarkGreen", "Green",0,0,"GMIDRailgunPuff")
			RGSP G 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP G 0 A_SetPitch(pitch+0.50)
			RGSP E 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP E 0 A_SetPitch(pitch+0.50)
			RGSP D 0 A_ZoomFactor(3.0)
			RGSP DEFG 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP H 11 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP H 0 A_JumpIfInventory("NewCell",10,"ZoomedRecharge")
			RGSP H 0 A_PlaySound("railgun/empty",CHAN_AUTO)
			goto Ready
		ZoomedRecharge:
			RGSP I 0 A_PlaySound("railgun/charge",CHAN_AUTO)
			RGSP I 46 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP B 1 Bright A_WeaponReady
			goto Ready
		Ready:
			TNT1 A 0 A_JumpIfInventory("RailgunToken",1,"FirstTime")
			RGUN A 0 A_JumpIfInventory("RailgunZoomed",1,"ZoomedReady")
			RGUN A 0 A_PlaySound("railgun/hum",CHAN_5,0.5,1)
			RGUN A 1 A_WeaponReady(WRF_ALLOWZOOM)
			Loop
		ZoomedReady:
			RGSP J 0 A_JumpIfInventory("NewCell",10,"ZoomedReallyReady")
			RGSP JJJJJJJKKKKKKK 1 Bright A_WeaponReady(WRF_ALLOWZOOM)
			Loop
		ZoomedReallyReady:
			RGSP B 1 Bright A_WeaponReady(WRF_ALLOWZOOM)
			Loop
		Zoom:
			RGUN A 0 A_JumpIfInventory("RailgunZoomed",1,"ZoomOut")
			RGNS A 0 A_PlaySound("railgun/scopeup",CHAN_AUTO)
			RGNS ABCD 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS D 0 A_GiveInventory("RailgunZoomed",1)
			RGNS D 0 A_SetBlend("Black",0.2,3)
			RGNS E 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS E 0 A_SetBlend("Black",0.4,3)
			RGNS F 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS F 0 A_SetBlend("Black",0.6,3)
			RGNS G 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS G 0 A_SetBlend("Black",0.8,3)
			RGNS H 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS H 0 A_SetBlend("Black",1,10)
			RGSP A 0 A_SetCrosshair(99)
			RGSP A 0 A_PlaySound("railgun/zoomin")
			RGSP A 0 A_ZoomFactor(3.0)
			RGSP A 5 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP A 0 A_SetBlend("Black",0.8,3)
			RGSP A 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP A 0 A_SetBlend("Black",0.6,3)
			RGSP A 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP A 0 A_SetBlend("Black",0.4,3)
			RGSP A 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP A 0 A_SetBlend("Black",0.2,3)
			RGSP A 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			Goto Ready
		ZoomOut:
			RGSP A 0 A_PlaySound("railgun/zoomout")
			RGSP A 0 A_TakeInventory("RailgunZoomed",1)
			RGSP A 0 A_ZoomFactor(1.0)
			RGSP A 0 A_SetBlend("Black",0.2,3)
			RGSP A 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP A 0 A_SetBlend("Black",0.4,3)
			RGSP A 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP A 0 A_SetBlend("Black",0.6,3)
			RGSP A 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP A 0 A_SetBlend("Black",0.8,3)
			RGSP A 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP A 0 A_SetBlend("Black",1,10)
			RGNS A 0 A_SetCrosshair(0)
			RGNS H 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS H 0 A_PlaySound("railgun/scopedown")
			RGNS GFE 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS D 0 A_SetBlend("Black",0.8,3)
			RGNS D 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS C 0 A_SetBlend("Black",0.6,3)
			RGNS C 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS B 0 A_SetBlend("Black",0.4,3)
			RGNS B 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS A 0 A_SetBlend("Black",0.2,3)
			RGNS A 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGUN A 5 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			Goto Ready
		ZoomOutThenDeselect:
			RGSP A 0 A_PlaySound("railgun/zoomout")
			RGSP A 0 A_TakeInventory("RailgunZoomed",1)
			RGSP A 0 A_ZoomFactor(1.0)
			RGSP A 0 A_SetBlend("Black",0.2,3)
			RGSP A 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP A 0 A_SetBlend("Black",0.4,3)
			RGSP A 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP A 0 A_SetBlend("Black",0.6,3)
			RGSP A 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP A 0 A_SetBlend("Black",0.8,3)
			RGSP A 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGSP A 0 A_SetBlend("Black",1,10)
			RGNS A 0 A_SetCrosshair(0)
			RGNS H 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS H 0 A_PlaySound("railgun/scopedown")
			RGNS GFE 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS D 0 A_SetBlend("Black",0.8,3)
			RGNS D 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS C 0 A_SetBlend("Black",0.6,3)
			RGNS C 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS B 0 A_SetBlend("Black",0.4,3)
			RGNS B 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGNS A 0 A_SetBlend("Black",0.2,3)
			RGNS A 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGUN A 5 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			Goto Deselect
		FirstTime:
			TNT1 A 0 A_TakeInventory("RailgunToken",0)
			TNT1 A 0 A_JumpIf(ACS_NamedExecuteWithResult("PVPCheck",0,0,0,0) == 2,"Ready")
			TNT1 A 0 A_JumpIf(CallACS("PickupAnimation")==0, "Ready")
			RGUN A 2 A_WeaponReady
			TNT1 A 0 A_PlaySound("weapon/fiddle", CHAN_AUTO)
			RGFS ABCDEFFFFF 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGFS G 0 A_PlaySound("railgun/fiddle1")
			RGFS GFGFGFFF 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGFS H 0 A_PlaySound("railgun/fiddle2")
			RGFS FHIJKKKKKKK 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGFS L 0 A_PlaySound("weapon/fiddle", CHAN_AUTO)
			RGFS LM 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGFS N 0 A_PlaySound("railgun/fiddle3")
			RGFS N 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGFS OPQRST 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			RGFS U 0 A_PlaySound("railgun/hum",CHAN_5,0.5,1)
			RGFS UVWXYA 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			Goto Ready
		Deselect:
			RGUN A 0 A_JumpIfInventory("RailgunZoomed",1,"ZoomOutThenDeselect")
			RGUN A 0 A_StopSound(CHAN_5)
			RGUN A 1 A_Lower
			RGUN A 0 A_Lower
			Loop
		Select:
			RGUN A 1 A_Raise
			RGUN A 0 A_Raise
			Loop
		Spawn:
			TNT1 A 0
			TNT1 A 0 A_Jump(128, "Spawn2")
			RGNG A -1
			Stop
		Spawn2:
			RGNG B -1
			Stop
	    AltFire:
			TNT1 A 0 A_JumpIfInventory("RailgunZoomed",1,"ZoomOut")
			TNT1 A 0 A_GunFlash("WeaponStill")
			TNT1 A 0 A_PlaySound ("weapons/KICK",CHAN_WEAPON)
			FOOT AB 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			FOOT C 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			FOOT D 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			FOOT D 0 A_JumpIfInventory("PowerQuadDamageST", 1, "QuadKick")
			FOOT D 0 A_JumpIfInventory("PowerDoubleDamage", 1, "DoubleKick")
			Goto ContinueKick
		QuadKick:
			TNT1 A 0 A_SetBlend("Blue", 0.25, 16)
			FOOT D 0 A_PlaySound("QuadDamage/Use",CHAN_7)
			Goto ContinueKick
		DoubleKick:
			TNT1 A 0 A_SetBlend("Red", 0.25, 16)
			FOOT D 0 A_PlaySound("DoubleDamage/Use",CHAN_7)
		ContinueKick:
			FOOT D 0 A_CustomPunch(5,0,0,"KickPuff")
			FOOT D 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			FOOT D 0 A_Quake(1,2,0,10,"")
			FOOT EF 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			FOOT FEDCBA 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
			TNT1 A 8 A_WeaponReady(WRF_NoFire)
			TNT1 A 0 A_ReFire
			Goto Ready
		WeaponStill:
			RGUN A 22
			Goto LightDone
	}
}

Actor GMIDRailgunPuff : BulletPuff
{
  +ALWAYSPUFF
  +BRIGHT
  +NOINTERACTION
  +FORCEXYBILLBOARD
  DamageType "GMIDRailgun"
  Scale 0.5
  States
  {
  Spawn:
	SHOK B 0
	SHOK B 0 A_PlaySound("railgun/hit")
	SHOK B 1 Bright
	TNT1 A 0 A_SetScale(0.75)
	TNT1 A 0 A_FadeOut(0.1)
	SHOK B 1 Bright
	TNT1 A 0 A_SetScale(1)
	TNT1 A 0 A_FadeOut(0.1)
	SHOK B 1 Bright
	TNT1 A 0 A_SetScale(1.25)
	TNT1 A 0 A_FadeOut(0.1)
	SHOK B 1 Bright
	TNT1 A 0 A_SetScale(1.5)
	TNT1 A 0 A_FadeOut(0.1)
	SHOK B 1 Bright
	TNT1 A 0 A_SetScale(1.75)
	TNT1 A 0 A_FadeOut(0.1)
	SHOK B 1 Bright
	TNT1 A 0 A_SetScale(2)
	TNT1 A 0 A_FadeOut(0.1)
	SHOK B 1 Bright
	TNT1 A 0 A_SetScale(2.25)
	TNT1 A 0 A_FadeOut(0.1)
	SHOK B 1 Bright
	TNT1 A 0 A_SetScale(2.5)
	TNT1 A 0 A_FadeOut(0.1)
	SHOK B 1 Bright
	TNT1 A 0 A_SetScale(2.75)
	TNT1 A 0 A_FadeOut(0.1)
	SHOK B 1 Bright
	Stop
  }
}

ACTOR NewCell : Ammo replaces SkullRodAmmo
{
  Inventory.PickupMessage "$GOTCHARGE1"
  Inventory.Amount 20
  Inventory.MaxAmount 300
  Ammo.BackpackAmount 20
  Ammo.BackpackMaxAmount 600
  Tag "$TAG_CHARGE1"
  Inventory.PickupSound "cell/get1"
  Inventory.Icon "CELLB0"
  States
  {
  Spawn:
    CELL A -1
    Stop
  }
}

ACTOR NewCellPack : NewCell replaces SkullRodHefty
{
  Tag "$TAG_CHARGE2"
  Inventory.PickupMessage "$GOTCHARGE2"
  Inventory.PickupSound "cell/get2"
  Inventory.Amount 100
  States
  {
  Spawn:
    CELP A -1
    Stop
  }
}