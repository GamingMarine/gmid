Actor DualPistolToken : Inventory {}
Actor HasFiredLeftBeretta : Inventory {}

Actor GMIDDualPistol : GMIDPistol
{
  Weapon.UpSound "pistup2"
  Tag "$TAG_BERETTA2"
  Inventory.PickupMessage "$GOTBERETTA2"
  Obituary "$OB_BERETTA2"
  Inventory.Icon "PISTB0" //For mods like DrPyspy's Weapon Wheel and Tapwave's War Trophies
  Weapon.SelectionOrder 1800
  States
  {
  Ready:
	TNT1 A 0 A_JumpIfInventory("DualPistolToken",1,"FirstTime")
	PISD A 1 A_WeaponReady
	Loop
  FirstTime:
	TNT1 A 0 A_TakeInventory("DualPistolToken",0)
	TNT1 A 0 A_JumpIf(ACS_NamedExecuteWithResult("PVPCheck",0,0,0,0) == 2,"Ready")
	TNT1 A 0 A_JumpIf(CallACS("PickupAnimation")==0, "Ready")
	PISD A 2 A_WeaponReady
	TNT1 A 0 A_PlaySound("weapon/fiddle")
	P2FS ABCDEEEEEEEEEEEEEEE 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	TNT1 A 0 A_PlaySound("weapon/fiddle")
	P2FS FGHIJ 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	TNT1 A 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	TNT1 A 0 A_PlaySound("weapon/fiddle")
	P2FS KLMNOPPPPPPPP 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	TNT1 A 0 A_PlaySound("2beretta/fiddle")
	P2FS PPQRRRRRRRRRR 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	TNT1 A 0 A_PlaySound("weapon/fiddle")
	P2FS STUVW 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	TNT1 A 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	TNT1 A 0 A_PlaySound("pistup2")
	P2FS XYZ 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	Goto Ready
  Fire:
	PIS1 A 0 A_JumpIfInventory("HasFiredLeftBeretta", 1, "StartFiringRight")
	PIS1 A 0 A_GunFlash("WeaponStill_Right")
	PIS1 A 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	PIS1 A 0 A_AlertMonsters
	PIS1 B 0 A_JumpIfInventory("PowerQuadDamageST", 1, "QuadFire")
	PIS1 B 0 A_JumpIfInventory("PowerDoubleDamage", 1, "DoubleFire")
	Goto ContinueFire
  QuadFire:
	TNT1 A 0 A_SetBlend("Blue", 0.25, 16)
	PISG B 0 A_PlaySound("QuadDamage/Use")
	Goto ContinueFire
  DoubleFire:
	TNT1 A 0 A_SetBlend("Red", 0.25, 16)
	PISG B 0 A_PlaySound("DoubleDamage/Use")
  ContinueFire:
	PIS1 B 0 A_SetPitch(pitch-0.3)
	PIS1 B 0 A_PlaySound("weapons/GMPISTOL", CHAN_WEAPON)
	PIS1 B 0 A_FireBullets (11.2, 0, 1, 5, "XaserPuff")
	PIS1 B 0 A_GiveInventory("HasFiredLeftBeretta",1)
    PIS1 B 0 A_FireCustomMissile("CasingSpawner",0,0,-13,0)
	PIS1 B 0 A_Light1
	PIS1 B 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	PIS1 C 0 A_Light0
	PIS1 C 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	PIS1 D 0 A_Light0
	PIS1 D 0 A_ReFire("HoldFire_Right")
	PIS1 D 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	PIS1 E 0 A_SetPitch(pitch+0.3)
	PIS1 E 0 A_GunFlash("WeaponStill_Right2")
	PIS1 EF 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	PISD A 5 A_WeaponReady
	Goto Ready
  HoldFire_Right:
	PIS2 A 0 A_SetPitch(pitch+0.3)
	PIS2 A 0 A_GunFlash("WeaponStill_Left3")
	PIS2 A 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	PIS2 A 0 A_AlertMonsters
	PIS2 B 0 A_JumpIfInventory("PowerQuadDamageST", 1, "QuadFire2")
	PIS2 B 0 A_JumpIfInventory("PowerDoubleDamage", 1, "DoubleFire2")
	Goto ContinueFire2
  QuadFire2:
	TNT1 A 0 A_SetBlend("Blue", 0.25, 16)
	PIS2 B 0 A_PlaySound("QuadDamage/Use")
	Goto ContinueFire2
  DoubleFire2:
	TNT1 A 0 A_SetBlend("Red", 0.25, 16)
	PIS2 B 0 A_PlaySound("DoubleDamage/Use")
  ContinueFire2:
	PIS2 B 0 A_SetPitch(pitch-0.3)
	PIS2 B 0 A_PlaySound("weapons/GMPISTOL", CHAN_WEAPON)
	PIS2 B 0 A_FireBullets (11.2, 0, 1, 5, "XaserPuff")
	PIS1 B 0 A_TakeInventory("HasFiredLeftBeretta",0)
    PIS2 B 0 A_FireCustomMissile("CasingSpawner",0,0,17,0)
	PIS2 B 0 A_Light1
	PIS2 B 1 Bright A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	PIS2 C 0 A_Light0
	PIS2 C 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	PIS2 D 0 A_Light0
	PIS2 D 0 A_ReFire("HoldFire_Left")
	PIS2 D 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	PIS2 E 0 A_SetPitch(pitch+0.3)
	PIS2 E 0 A_GunFlash("WeaponStill_Left2")
	PIS2 EF 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	PISD A 5 A_WeaponReady
	Goto Ready
  HoldFire_Left:
	PIS2 A 0 A_SetPitch(pitch+0.3)
	PIS1 A 0 A_GunFlash("WeaponStill_Right3")
	PIS1 A 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	PIS1 A 0 A_AlertMonsters
	PIS1 B 0 A_JumpIfInventory("PowerQuadDamageST", 1, "QuadFire")
	PIS1 B 0 A_JumpIfInventory("PowerDoubleDamage", 1, "DoubleFire")
	Goto ContinueFire
  StartFiringRight:
	PIS2 A 0 A_GunFlash("WeaponStill_Left")
	PIS2 A 2 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	PIS2 A 0 A_AlertMonsters
	PIS2 B 0 A_JumpIfInventory("PowerQuadDamageST", 1, "QuadFire2")
	PIS2 B 0 A_JumpIfInventory("PowerDoubleDamage", 1, "DoubleFire2")
	Goto ContinueFire2
  AltFire:
	TNT1 A 0 A_GunFlash("WeaponStill")
	TNT1 A 0 A_PlaySound ("weapons/KICK",CHAN_WEAPON)
	FOOT AB 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	FOOT C 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	FOOT D 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	FOOT D 0 A_JumpIfInventory("PowerQuadDamageST", 1, "QuadKick")
	FOOT D 0 A_JumpIfInventory("PowerDoubleDamage", 1, "DoubleKick")
	Goto ContinueKick
  QuadKick:
	TNT1 A 0 A_SetBlend("Blue", 0.25, 16)
	FOOT D 0 A_PlaySound("QuadDamage/Use",CHAN_7)
	Goto ContinueKick
  DoubleKick:
	TNT1 A 0 A_SetBlend("Red", 0.25, 16)
	FOOT D 0 A_PlaySound("DoubleDamage/Use",CHAN_7)
  ContinueKick:
	FOOT D 0 A_CustomPunch(5,0,0,"KickPuff")
	FOOT D 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	FOOT D 0 A_Quake(1,2,0,10,"")
	FOOT EF 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	FOOT FEDCBA 1 A_WeaponReady(WRF_NoFire|WRF_NoSwitch)
	TNT1 A 8 A_WeaponReady(WRF_NoFire)
	TNT1 A 0 A_ReFire
	Goto Ready
  WeaponStill:
	PISD A 22
	Goto LightDone
  WeaponStill_Left:
	PIS1 A 5
	Goto LightDone
  WeaponStill_Left2:
	PIS1 A 3
	Goto LightDone
  WeaponStill_Left3:
	PIS1 DEFAA 1
	Goto LightDone
  WeaponStill_Right:
	PIS2 A 5
	Goto LightDone
  WeaponStill_Right2:
	PIS2 A 3
	Goto LightDone
  WeaponStill_Right3:
	PIS2 EFAAA 1
	Goto LightDone
  Deselect:
    PISD A 1 A_Lower
    PISD A 0 A_Lower
    Loop
  Select:
    PISD A 1 A_Raise
    PISD A 0 A_Raise
    Loop
  }
}